# Template file for 'libgbinder'
pkgname=libgbinder
version=1.1.13
revision=1
build_style=gnu-makefile
make_install_target="install-dev"
make_build_args="KEEP_SYMBOLS=1 release pkgconfig"
hostmakedepends="pkg-config libglibutil-devel"
short_desc="GLib-style interface to binder (Android IPC mechanism)"
maintainer="Jami Kettunen <jami.kettunen@somainline.org>"
license="BSD-3-Clause"
homepage="https://github.com/mer-hybris/libgbinder"
distfiles="${homepage}/archive/refs/tags/${version}.tar.gz"
checksum=649c00ca5f9e23cd49e7031aaae43d6a2473d7dbccbd6f4c98f6b773dbd0e8a9

if [ $CROSS_BUILD ]; then
	makedepends="libglibutil-devel"
fi

pre_build() {
	LD=$CC
}

_tools="binder-bridge binder-list binder-ping"
_tools_build() {
	for tool in ${_tools}; do
		make -C test/${tool} KEEP_SYMBOLS=1 release # ${makejobs}
	done
}
_tools_install() {
	for tool in ${_tools}; do
		make DESTDIR="$PKGDESTDIR" -C test/${tool} KEEP_SYMBOLS=1 install # ${makejobs}
	done
}

post_build() {
	_tools_build
}

post_install() {
	vlicense LICENSE
}

libgbinder-devel_package() {
	depends="libgbinder>=${version}_${revision} libglibutil-devel"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove "usr/lib/*.so"
	}
}

libgbinder-tools_package() {
	depends="libgbinder>=${version}_${revision}"
	short_desc+=" - testing tools"
	pkg_install() {
		_tools_install
	}
}
