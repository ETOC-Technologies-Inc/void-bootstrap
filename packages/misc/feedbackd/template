# Template file for 'feedbackd'
pkgname=feedbackd
version=0.0.2
revision=2
_gmobile_commit=1039e7808195d4de367ce2718481641ca8af2427
build_style=meson
build_helper=gir
hostmakedepends="vala glib-devel pkg-config"
makedepends="gsound-devel libgudev-devel json-glib-devel"
depends="dbus"
checkdepends="dbus"
short_desc="Daemon to provide haptic feedback on events"
maintainer="Jami Kettunen <jami.kettunen@somainline.org>"
license="GPL-3.0-or-later"
homepage="https://source.puri.sm/Librem5/feedbackd"
distfiles="https://source.puri.sm/Librem5/feedbackd/-/archive/v${version}.tar.gz
 https://gitlab.gnome.org/guidog/gmobile/-/archive/${_gmobile_commit}.tar.gz"
checksum="3132021120a0ffd677f204aa74b614d06d2f2bcc9b4ed6b3de64f3e654663b67
 44993335371a7e64fd57663f7458f1d1c7ae00f150a66c2f2f897ae21c5894a9"

system_groups="feedbackd"

pre_patch() {
	mv feedbackd-v${version}-*/* .
	mv gmobile-${_gmobile_commit}/* subprojects/gmobile/
}

post_install() {
	vinstall debian/feedbackd.udev 0644 usr/lib/udev/rules.d 90-feedbackd.rules
}

feedbackd-devel_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove "usr/lib/*.so"
	}
}
